# 标准减灾能力评估模型 - 算法公式参考手册

## 评估流程概览

```
调查数据(survey_data)
    ↓
步骤1: 评估指标赋值 (8个二级指标原始值)
    ↓
步骤2: 属性向量归一化 (8个归一化值)
    ↓
步骤3: 定权计算 (8个一级定权 + 8个综合定权)
    ↓
步骤4: 优劣解计算 (3组一级优劣解 + 1组综合优劣解)
    ↓
步骤5: 能力值计算与分级 (4个能力值 + 4个分级结果)
```

---

## 步骤1：评估指标赋值

### 输入数据（来自 survey_data 表）
- `population`: 常住人口数量
- `management_staff`: 本级灾害管理工作人员总数
- `risk_assessment`: 是否开展乡镇（街道）灾害风险评估
- `funding_amount`: 上一年度防灾减灾救灾资金投入总金额（万元）
- `material_value`: 现有储备物资、装备折合金额（万元）
- `hospital_beds`: 实有住院床位数
- `firefighters`: 消防员数量
- `volunteers`: 志愿者人数
- `militia_reserve`: 民兵预备役人数
- `training_participants`: 上一年度组织的应急管理培训和演练参与人次
- `shelter_capacity`: 本级灾害应急避难场所容量

### 计算公式

#### 1. 队伍管理能力
```
teamManagement = (management_staff / population) × 10000
```

#### 2. 风险评估能力
```
riskAssessment = IF(risk_assessment 包含 "是", 1, 0)
```

#### 3. 财政投入能力
```
financialInput = (funding_amount / population) × 10000
```

#### 4. 物资储备能力
```
materialReserve = (material_value / population) × 10000
```

#### 5. 医疗保障能力
```
medicalSupport = (hospital_beds / population) × 10000
```

#### 6. 自救互救能力
```
selfRescue = ((firefighters + volunteers + militia_reserve) / population) × 10000
```

#### 7. 公众避险能力
```
publicAvoidance = (training_participants / population) × 100
```
**注意**: 此处是 × 100，不是 × 10000

#### 8. 转移安置能力
```
relocationCapacity = shelter_capacity / population
```
**注意**: 此处不乘以系数

---

## 步骤2：属性向量归一化

### 通用公式
```
归一化值 = 本乡镇指标值 / SQRT(SUMSQ(全部乡镇指标值))
```

其中：
- `SUMSQ`: 所有乡镇该指标值的平方和
- `SQRT`: 平方根

### 具体计算

#### 1. 队伍管理能力归一化
```
teamManagementNorm = teamManagement / SQRT(SUMSQ(所有乡镇的 teamManagement))
```

#### 2. 风险评估能力归一化
```
riskAssessmentNorm = riskAssessment / SQRT(SUMSQ(所有乡镇的 riskAssessment))
```

#### 3. 财政投入能力归一化
```
financialInputNorm = financialInput / SQRT(SUMSQ(所有乡镇的 financialInput))
```

#### 4. 物资储备能力归一化
```
materialReserveNorm = materialReserve / SQRT(SUMSQ(所有乡镇的 materialReserve))
```

#### 5. 医疗保障能力归一化
```
medicalSupportNorm = medicalSupport / SQRT(SUMSQ(所有乡镇的 medicalSupport))
```

#### 6. 自救互救能力归一化
```
selfRescueNorm = selfRescue / SQRT(SUMSQ(所有乡镇的 selfRescue))
```

#### 7. 公众避险能力归一化
```
publicAvoidanceNorm = publicAvoidance / SQRT(SUMSQ(所有乡镇的 publicAvoidance))
```

#### 8. 转移安置能力归一化
```
relocationCapacityNorm = relocationCapacity / SQRT(SUMSQ(所有乡镇的 relocationCapacity))
```

---

## 步骤3：定权计算

### 第一部分：一级指标定权（使用二级权重）

#### 公式模板
```
定权值 = 归一化值 × 二级权重
```

#### 具体计算

1. **队伍管理能力定权**
   ```
   teamManagementWeighted = teamManagementNorm × weight_TEAM_MANAGEMENT
   ```

2. **风险评估能力定权**
   ```
   riskAssessmentWeighted = riskAssessmentNorm × weight_RISK_ASSESSMENT
   ```

3. **财政投入能力定权**
   ```
   financialInputWeighted = financialInputNorm × weight_FINANCIAL_INPUT
   ```

4. **物资储备能力定权**
   ```
   materialReserveWeighted = materialReserveNorm × weight_MATERIAL_RESERVE
   ```

5. **医疗保障能力定权**
   ```
   medicalSupportWeighted = medicalSupportNorm × weight_MEDICAL_SUPPORT
   ```

6. **自救互救能力定权**
   ```
   selfRescueWeighted = selfRescueNorm × weight_SELF_RESCUE
   ```

7. **公众避险能力定权**
   ```
   publicAvoidanceWeighted = publicAvoidanceNorm × weight_PUBLIC_AVOIDANCE
   ```

8. **转移安置能力定权**
   ```
   relocationCapacityWeighted = relocationCapacityNorm × weight_RELOCATION_CAPACITY
   ```

### 第二部分：乡镇街道减灾能力定权（使用一级权重 × 二级权重）

#### 公式模板
```
综合定权值 = 归一化值 × 一级权重 × 二级权重
```

#### 具体计算

1. **队伍管理能力综合定权**
   ```
   teamManagementTotal = teamManagementNorm × weight_DISASTER_MANAGEMENT × weight_TEAM_MANAGEMENT
   ```

2. **风险评估能力综合定权**
   ```
   riskAssessmentTotal = riskAssessmentNorm × weight_DISASTER_MANAGEMENT × weight_RISK_ASSESSMENT
   ```

3. **财政投入能力综合定权**
   ```
   financialInputTotal = financialInputNorm × weight_DISASTER_MANAGEMENT × weight_FINANCIAL_INPUT
   ```

4. **物资储备能力综合定权**
   ```
   materialReserveTotal = materialReserveNorm × weight_DISASTER_PREPAREDNESS × weight_MATERIAL_RESERVE
   ```

5. **医疗保障能力综合定权**
   ```
   medicalSupportTotal = medicalSupportNorm × weight_DISASTER_PREPAREDNESS × weight_MEDICAL_SUPPORT
   ```

6. **自救互救能力综合定权**
   ```
   selfRescueTotal = selfRescueNorm × weight_SELF_RESCUE_TRANSFER × weight_SELF_RESCUE
   ```

7. **公众避险能力综合定权**
   ```
   publicAvoidanceTotal = publicAvoidanceNorm × weight_SELF_RESCUE_TRANSFER × weight_PUBLIC_AVOIDANCE
   ```

8. **转移安置能力综合定权**
   ```
   relocationCapacityTotal = relocationCapacityNorm × weight_SELF_RESCUE_TRANSFER × weight_RELOCATION_CAPACITY
   ```

---

## 步骤4：优劣解算法计算（TOPSIS方法）

### 第一部分：一级指标优劣解

#### 1. 灾害管理能力

**正理想解（优）**:
```
disasterMgmtPositive = SQRT(
    (MAX(teamManagementWeighted) - teamManagementWeighted)² +
    (MAX(riskAssessmentWeighted) - riskAssessmentWeighted)² +
    (MAX(financialInputWeighted) - financialInputWeighted)²
)
```

**负理想解（差）**:
```
disasterMgmtNegative = SQRT(
    (MIN(teamManagementWeighted) - teamManagementWeighted)² +
    (MIN(riskAssessmentWeighted) - riskAssessmentWeighted)² +
    (MIN(financialInputWeighted) - financialInputWeighted)²
)
```

#### 2. 灾害备灾能力

**正理想解（优）**:
```
disasterPrepPositive = SQRT(
    (MAX(materialReserveWeighted) - materialReserveWeighted)² +
    (MAX(medicalSupportWeighted) - medicalSupportWeighted)²
)
```

**负理想解（差）**:
```
disasterPrepNegative = SQRT(
    (MIN(materialReserveWeighted) - materialReserveWeighted)² +
    (MIN(medicalSupportWeighted) - medicalSupportWeighted)²
)
```

#### 3. 自救转移能力

**正理想解（优）**:
```
selfRescuePositive = SQRT(
    (MAX(selfRescueWeighted) - selfRescueWeighted)² +
    (MAX(publicAvoidanceWeighted) - publicAvoidanceWeighted)² +
    (MAX(relocationCapacityWeighted) - relocationCapacityWeighted)²
)
```

**负理想解（差）**:
```
selfRescueNegative = SQRT(
    (MIN(selfRescueWeighted) - selfRescueWeighted)² +
    (MIN(publicAvoidanceWeighted) - publicAvoidanceWeighted)² +
    (MIN(relocationCapacityWeighted) - relocationCapacityWeighted)²
)
```

### 第二部分：综合减灾能力优劣解

#### 综合减灾能力

**正理想解（优）**:
```
totalPositive = SQRT(
    (MAX(teamManagementTotal) - teamManagementTotal)² +
    (MAX(riskAssessmentTotal) - riskAssessmentTotal)² +
    (MAX(financialInputTotal) - financialInputTotal)² +
    (MAX(materialReserveTotal) - materialReserveTotal)² +
    (MAX(medicalSupportTotal) - medicalSupportTotal)² +
    (MAX(selfRescueTotal) - selfRescueTotal)² +
    (MAX(publicAvoidanceTotal) - publicAvoidanceTotal)² +
    (MAX(relocationCapacityTotal) - relocationCapacityTotal)²
)
```

**负理想解（差）**:
```
totalNegative = SQRT(
    (MIN(teamManagementTotal) - teamManagementTotal)² +
    (MIN(riskAssessmentTotal) - riskAssessmentTotal)² +
    (MIN(financialInputTotal) - financialInputTotal)² +
    (MIN(materialReserveTotal) - materialReserveTotal)² +
    (MIN(medicalSupportTotal) - medicalSupportTotal)² +
    (MIN(selfRescueTotal) - selfRescueTotal)² +
    (MIN(publicAvoidanceTotal) - publicAvoidanceTotal)² +
    (MIN(relocationCapacityTotal) - relocationCapacityTotal)²
)
```

---

## 步骤5：能力值计算与分级

### 第一部分：能力值计算（贴近度）

#### 公式模板
```
能力值 = 负理想解距离 / (负理想解距离 + 正理想解距离)
```

#### 具体计算

1. **灾害管理能力值**
   ```
   disasterMgmtScore = disasterMgmtNegative / (disasterMgmtNegative + disasterMgmtPositive)
   ```

2. **灾害备灾能力值**
   ```
   disasterPrepScore = disasterPrepNegative / (disasterPrepNegative + disasterPrepPositive)
   ```

3. **自救转移能力值**
   ```
   selfRescueScore = selfRescueNegative / (selfRescueNegative + selfRescuePositive)
   ```

4. **综合减灾能力值**
   ```
   totalScore = totalNegative / (totalNegative + totalPositive)
   ```

### 第二部分：能力分级

#### 分级方法
基于均值（μ）和标准差（σ）进行五级分类

#### 分级规则

**情况1**: 当 μ ≤ 0.5σ 时
```
IF value ≥ μ + 1.5σ  THEN "强"
ELSE IF value ≥ μ + 0.5σ  THEN "较强"
ELSE "中等"
```

**情况2**: 当 0.5σ < μ ≤ 1.5σ 时
```
IF value ≥ μ + 1.5σ  THEN "强"
ELSE IF value ≥ μ + 0.5σ  THEN "较强"
ELSE IF value ≥ μ - 0.5σ  THEN "中等"
ELSE "较弱"
```

**情况3**: 当 μ > 1.5σ 时（正常分布）
```
IF value ≥ μ + 1.5σ  THEN "强"
ELSE IF value ≥ μ + 0.5σ  THEN "较强"
ELSE IF value ≥ μ - 0.5σ  THEN "中等"
ELSE IF value ≥ μ - 1.5σ  THEN "较弱"
ELSE "弱"
```

#### 具体计算

1. **灾害管理能力分级**
   ```
   计算：μ = AVERAGE(所有乡镇的 disasterMgmtScore)
   计算：σ = STDEV(所有乡镇的 disasterMgmtScore)
   应用分级规则 → disasterMgmtGrade
   ```

2. **灾害备灾能力分级**
   ```
   计算：μ = AVERAGE(所有乡镇的 disasterPrepScore)
   计算：σ = STDEV(所有乡镇的 disasterPrepScore)
   应用分级规则 → disasterPrepGrade
   ```

3. **自救转移能力分级**
   ```
   计算：μ = AVERAGE(所有乡镇的 selfRescueScore)
   计算：σ = STDEV(所有乡镇的 selfRescueScore)
   应用分级规则 → selfRescueGrade
   ```

4. **综合减灾能力分级**
   ```
   计算：μ = AVERAGE(所有乡镇的 totalScore)
   计算：σ = STDEV(所有乡镇的 totalScore)
   应用分级规则 → totalGrade
   ```

---

## 权重配置

### 一级指标权重（来自 indicator_weight 表）

| 指标编码 | 指标名称 | 权重变量 | 默认值 |
|---------|---------|---------|-------|
| DISASTER_MANAGEMENT | 灾害管理能力 | weight_DISASTER_MANAGEMENT | 0.30 |
| DISASTER_PREPAREDNESS | 灾害备灾能力 | weight_DISASTER_PREPAREDNESS | 0.35 |
| SELF_RESCUE_TRANSFER | 自救转移能力 | weight_SELF_RESCUE_TRANSFER | 0.35 |

### 二级指标权重（来自 indicator_weight 表）

| 一级指标 | 二级指标编码 | 二级指标名称 | 权重变量 | 默认值 |
|---------|------------|------------|---------|-------|
| 灾害管理能力 | TEAM_MANAGEMENT | 队伍管理能力 | weight_TEAM_MANAGEMENT | 0.33 |
| 灾害管理能力 | RISK_ASSESSMENT | 风险评估能力 | weight_RISK_ASSESSMENT | 0.33 |
| 灾害管理能力 | FINANCIAL_INPUT | 财政投入能力 | weight_FINANCIAL_INPUT | 0.34 |
| 灾害备灾能力 | MATERIAL_RESERVE | 物资储备能力 | weight_MATERIAL_RESERVE | 0.50 |
| 灾害备灾能力 | MEDICAL_SUPPORT | 医疗保障能力 | weight_MEDICAL_SUPPORT | 0.50 |
| 自救转移能力 | SELF_RESCUE | 自救互救能力 | weight_SELF_RESCUE | 0.40 |
| 自救转移能力 | PUBLIC_AVOIDANCE | 公众避险能力 | weight_PUBLIC_AVOIDANCE | 0.30 |
| 自救转移能力 | RELOCATION_CAPACITY | 转移安置能力 | weight_RELOCATION_CAPACITY | 0.30 |

**注意**: 各级指标权重之和应为1.0

---

## 数据流转示例

### 示例数据
假设某乡镇的调查数据如下：
- 常住人口：50,000人
- 灾害管理工作人员：25人
- 是否开展风险评估：是
- 防灾资金投入：100万元
- 储备物资价值：80万元
- 住院床位数：200张
- 消防员：20人
- 志愿者：100人
- 民兵预备役：50人
- 培训参与人次：1,000人次
- 避难场所容量：10,000人

### 步骤1：评估指标赋值
```
teamManagement = (25 / 50000) × 10000 = 5.0
riskAssessment = 1.0
financialInput = (100 / 50000) × 10000 = 20.0
materialReserve = (80 / 50000) × 10000 = 16.0
medicalSupport = (200 / 50000) × 10000 = 40.0
selfRescue = ((20 + 100 + 50) / 50000) × 10000 = 34.0
publicAvoidance = (1000 / 50000) × 100 = 2.0
relocationCapacity = 10000 / 50000 = 0.2
```

### 步骤2：属性向量归一化
假设全区共有10个乡镇，计算teamManagement的归一化值：
```
SUMSQ = 5.0² + 4.5² + 6.0² + ... (10个乡镇)
假设 SQRT(SUMSQ) = 15.8
teamManagementNorm = 5.0 / 15.8 = 0.316
```

### 步骤3：定权计算
假设 weight_TEAM_MANAGEMENT = 0.33:
```
teamManagementWeighted = 0.316 × 0.33 = 0.104
```

假设 weight_DISASTER_MANAGEMENT = 0.30:
```
teamManagementTotal = 0.316 × 0.30 × 0.33 = 0.031
```

### 步骤4：优劣解计算
假设灾害管理能力的三个定权指标：
- teamManagementWeighted: 0.104（本乡镇）, MAX: 0.150, MIN: 0.080
- riskAssessmentWeighted: 0.095（本乡镇）, MAX: 0.100, MIN: 0.080
- financialInputWeighted: 0.110（本乡镇）, MAX: 0.140, MIN: 0.090
```
disasterMgmtPositive = SQRT((0.150-0.104)² + (0.100-0.095)² + (0.140-0.110)²)
                     = SQRT(0.002116 + 0.000025 + 0.000900)
                     = SQRT(0.003041)
                     = 0.055

disasterMgmtNegative = SQRT((0.080-0.104)² + (0.080-0.095)² + (0.090-0.110)²)
                     = SQRT(0.000576 + 0.000225 + 0.000400)
                     = SQRT(0.001201)
                     = 0.035
```

### 步骤5：能力值计算与分级
```
disasterMgmtScore = 0.035 / (0.035 + 0.055) = 0.389
```

假设全区的统计数据：
- μ = 0.450
- σ = 0.120
```
μ = 0.450 > 1.5σ = 0.180 (情况3)
value = 0.389

检查分级条件：
- μ + 1.5σ = 0.450 + 0.180 = 0.630  (0.389 < 0.630)
- μ + 0.5σ = 0.450 + 0.060 = 0.510  (0.389 < 0.510)
- μ - 0.5σ = 0.450 - 0.060 = 0.390  (0.389 < 0.390)
- μ - 1.5σ = 0.450 - 0.180 = 0.270  (0.389 > 0.270)

结果：disasterMgmtGrade = "较弱"
```

---

## 附录：Excel原始公式对照

### Excel中的公式示例

#### 评估指标赋值
```excel
=B2/C2*10000                    # 队伍管理能力
=IF(D2="[""是""]",1,0)          # 风险评估能力
```

#### 属性向量归一化
```excel
=E2/SQRT(SUMSQ($E$2:$E$11))     # 队伍管理能力归一化
```

#### 定权计算
```excel
=M2*$V$2                        # 一级指标定权
=M2*$U$2*$V$2                   # 综合定权
```

#### 优劣解计算
```excel
=SQRT((MAX($U$2:$U$11)-U2)^2+(MAX($V$2:$V$11)-V2)^2+(MAX($W$2:$W$11)-W2)^2)  # 正理想解
=SQRT((MIN($U$2:$U$11)-U2)^2+(MIN($V$2:$V$11)-V2)^2+(MIN($W$2:$W$11)-W2)^2)  # 负理想解
```

#### 能力值计算
```excel
=BJ2/(BJ2+BI2)                  # 能力值
```

#### 能力分级
```excel
=IF($BM$12<=0.5*$BN$12,IF(BL2>=$BM$12+1.5*$BN$12,"强",IF(BL2>=$BM$12+0.5*$BN$12,"较强","中等")),IF($BM$12<=1.5*$BN$12,IF(BL2>=$BM$12+1.5*$BN$12,"强",IF(BL2>=$BM$12+0.5*$BN$12,"较强",IF(BL2>=$BM$12-0.5*$BN$12,"中等","较弱"))),IF(BL2>=$BM$12+1.5*$BN$12,"强",IF(BL2>=$BM$12+0.5*$BN$12,"较强",IF(BL2>=$BM$12-0.5*$BN$12,"中等",IF(BL2>=$BM$12-1.5*$BN$12,"较弱","弱"))))))
```

---

## 常见问题

### Q1: 为什么公众避险能力乘以100而不是10000？
**A**: 因为培训参与人次相对于人口基数比例较高，使用100作为基数可以得到更合理的数值范围。

### Q2: 转移安置能力为什么不乘以系数？
**A**: 转移安置能力本身就是比例值（避难场所容量/人口），不需要额外的缩放系数。

### Q3: 归一化的目的是什么？
**A**: 消除不同指标的量纲影响，使所有指标处于同一数量级，便于后续的综合评价。

### Q4: TOPSIS方法的优势是什么？
**A**: TOPSIS（逼近理想解排序法）能够同时考虑最优和最劣方案，充分利用原始数据的信息，结果更加合理。

### Q5: 分级规则为什么要考虑μ和σ的关系？
**A**: 不同的μ/σ比值反映了数据分布的不同特征，采用自适应分级规则能够更准确地反映实际情况。

---

**文档版本**: 1.0  
**最后更新**: 2025-10-12  
**适用模型**: 标准减灾能力评估模型 (STANDARD_MODEL)
