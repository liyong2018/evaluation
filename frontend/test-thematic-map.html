<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>专题图功能测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
        }
        .test-button {
            background: #409eff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        .test-button:hover {
            background: #337ecc;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f0f9ff;
            border-left: 4px solid #409eff;
        }
        .error {
            background: #fef0f0;
            border-left-color: #f56c6c;
        }
        .success {
            background: #f0f9f0;
            border-left-color: #67c23a;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>专题图功能测试页面</h1>
        <p>此页面用于测试专题图按钮的功能和数据传递逻辑</p>
        
        <div class="test-section">
            <h3>测试1：模拟专题图按钮点击</h3>
            <p>模拟从Results页面点击专题图按钮的行为</p>
            <button class="test-button" onclick="testThematicMapButton()">测试专题图按钮</button>
            <div id="test1-result" class="result" style="display:none;"></div>
        </div>
        
        <div class="test-section">
            <h3>测试2：检查sessionStorage数据</h3>
            <p>检查sessionStorage中是否正确存储了专题图数据</p>
            <button class="test-button" onclick="checkSessionStorage()">检查存储数据</button>
            <div id="test2-result" class="result" style="display:none;"></div>
        </div>
        
        <div class="test-section">
            <h3>测试3：跳转到专题图页面</h3>
            <p>测试跳转到专题图页面并传递数据</p>
            <button class="test-button" onclick="navigateToThematicMap()">跳转专题图页面</button>
            <div id="test3-result" class="result" style="display:none;"></div>
        </div>
        
        <div class="test-section">
            <h3>测试4：清理测试数据</h3>
            <p>清理sessionStorage中的测试数据</p>
            <button class="test-button" onclick="clearTestData()">清理数据</button>
            <div id="test4-result" class="result" style="display:none;"></div>
        </div>
    </div>

    <script>
        // 模拟评估结果数据
        const mockResultData = {
            id: 1,
            regionName: '青神县',
            evaluationTime: '2024-01-15 14:30:00',
            algorithm: 'AHP层次分析法',
            totalScore: 85.6,
            level: '良好',
            details: {
                infrastructure: 78.5,
                management: 82.3,
                response: 89.1,
                recovery: 87.2
            }
        };
        
        function testThematicMapButton() {
            const resultDiv = document.getElementById('test1-result');
            try {
                // 模拟专题图按钮的点击逻辑
                const thematicMapData = {
                    id: mockResultData.id,
                    regionName: mockResultData.regionName,
                    evaluationTime: mockResultData.evaluationTime,
                    algorithm: mockResultData.algorithm,
                    totalScore: mockResultData.totalScore,
                    level: mockResultData.level
                };
                
                // 存储到sessionStorage
                sessionStorage.setItem('thematicMapData', JSON.stringify(thematicMapData));
                
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <strong>✓ 测试成功</strong><br>
                    已模拟专题图按钮点击，数据已存储到sessionStorage<br>
                    数据内容：${JSON.stringify(thematicMapData, null, 2)}
                `;
                resultDiv.style.display = 'block';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<strong>✗ 测试失败</strong><br>错误：${error.message}`;
                resultDiv.style.display = 'block';
            }
        }
        
        function checkSessionStorage() {
            const resultDiv = document.getElementById('test2-result');
            try {
                const storedData = sessionStorage.getItem('thematicMapData');
                if (storedData) {
                    const parsedData = JSON.parse(storedData);
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <strong>✓ 数据存在</strong><br>
                        存储的数据：<pre>${JSON.stringify(parsedData, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = '<strong>✗ 未找到数据</strong><br>sessionStorage中没有thematicMapData';
                }
                resultDiv.style.display = 'block';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<strong>✗ 检查失败</strong><br>错误：${error.message}`;
                resultDiv.style.display = 'block';
            }
        }
        
        function navigateToThematicMap() {
            const resultDiv = document.getElementById('test3-result');
            try {
                // 确保有数据
                if (!sessionStorage.getItem('thematicMapData')) {
                    testThematicMapButton();
                }
                
                // 跳转到专题图页面
                const baseUrl = window.location.origin;
                const thematicMapUrl = `${baseUrl}/thematic-map`;
                
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <strong>✓ 准备跳转</strong><br>
                    目标URL：${thematicMapUrl}<br>
                    <a href="${thematicMapUrl}" target="_blank" style="color: #409eff;">点击这里跳转到专题图页面</a>
                `;
                resultDiv.style.display = 'block';
                
                // 自动跳转（可选）
                // window.open(thematicMapUrl, '_blank');
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<strong>✗ 跳转失败</strong><br>错误：${error.message}`;
                resultDiv.style.display = 'block';
            }
        }
        
        function clearTestData() {
            const resultDiv = document.getElementById('test4-result');
            try {
                sessionStorage.removeItem('thematicMapData');
                resultDiv.className = 'result success';
                resultDiv.innerHTML = '<strong>✓ 清理完成</strong><br>已清除sessionStorage中的测试数据';
                resultDiv.style.display = 'block';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<strong>✗ 清理失败</strong><br>错误：${error.message}`;
                resultDiv.style.display = 'block';
            }
        }
        
        // 页面加载时的初始化
        window.onload = function() {
            console.log('专题图功能测试页面已加载');
            console.log('当前URL:', window.location.href);
            console.log('sessionStorage状态:', sessionStorage.getItem('thematicMapData') ? '有数据' : '无数据');
        };
    </script>
</body>
</html>