# 快速启动指南

## 📦 已完成的QLExpress模型管理功能

### ✅ 后端组件
- QLExpress 3.3.2规则引擎
- 5个新数据库表
- 完整的模型管理API
- 实时表达式验证

### ✅ 已创建的文件
```
pom.xml (已更新)
src/main/java/com/evaluate/
├── entity/
│   ├── EvaluationModel.java
│   ├── ModelStep.java
│   └── StepAlgorithm.java
├── mapper/
│   ├── EvaluationModelMapper.java
│   ├── ModelStepMapper.java
│   └── StepAlgorithmMapper.java
├── service/
│   ├── QLExpressService.java
│   └── impl/QLExpressServiceImpl.java
└── controller/
    └── ModelManagementController.java

migrations/
├── 002_create_model_management.sql
└── 003_init_model_formulas.sql
```

## 🚀 立即使用（3步启动）

### 步骤1: 执行数据库迁移 (2分钟)

打开任意MySQL客户端工具（HeidiSQL/Navicat/MySQL Workbench），执行：

```sql
-- 连接信息
-- Host: localhost:3306
-- User: root
-- Password: Htht1234
-- Database: evaluate_db

-- 依次执行以下文件：
SOURCE C:/Users/Administrator/Development/evaluation/migrations/002_create_model_management.sql;
SOURCE C:/Users/Administrator/Development/evaluation/migrations/003_init_model_formulas.sql;
```

或者在PowerShell中（如果找到MySQL路径）：
```powershell
# 查找MySQL安装目录
Get-ChildItem "C:\Program Files\MySQL" -Recurse -Filter "mysql.exe"

# 使用找到的路径执行（替换为实际路径）
& "路径\mysql.exe" -u root -pHtht1234 evaluate_db < migrations\002_create_model_management.sql
& "路径\mysql.exe" -u root -pHtht1234 evaluate_db < migrations\003_init_model_formulas.sql
```

### 步骤2: 重启后端服务 (30秒)

```powershell
# 停止当前服务
Stop-Job -Name "SpringBootApp"

# 重新启动
Start-Job -ScriptBlock { 
    Set-Location 'C:\Users\Administrator\Development\evaluation'
    mvn spring-boot:run 
} -Name "SpringBootApp"

# 等待10秒后检查日志
Start-Sleep 10
Receive-Job -Name "SpringBootApp" -Keep | Select-String "Started EvaluateApplication"
```

### 步骤3: 测试API (10秒)

```powershell
# 测试获取模型列表
$response = Invoke-WebRequest -Uri "http://localhost:8081/api/model-management/models" -Method GET
$response.Content | ConvertFrom-Json | ConvertTo-Json -Depth 10

# 应该返回默认模型 "标准减灾能力评估模型"
```

## 🎯 快速验证

### 验证1: 查看默认模型
```powershell
Invoke-RestMethod -Uri "http://localhost:8081/api/model-management/models" -Method GET
```

期望输出：
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "modelName": "标准减灾能力评估模型",
      "modelCode": "STANDARD_MODEL",
      "description": "基于TOPSIS算法的标准减灾能力评估模型...",
      "status": 1,
      "isDefault": true
    }
  ]
}
```

### 验证2: 查看模型详情
```powershell
Invoke-RestMethod -Uri "http://localhost:8081/api/model-management/models/1/detail" -Method GET
```

应该返回模型的7个步骤和对应算法。

### 验证3: 验证QLExpress表达式
```powershell
$body = @{
    expression = "(management_staff / population) * 10000"
    context = @{
        management_staff = 10
        population = 1000
    }
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8081/api/model-management/validate-expression" `
    -Method POST `
    -Body $body `
    -ContentType "application/json"
```

期望输出：
```json
{
  "success": true,
  "valid": true,
  "errorMessage": null
}
```

## 📝 下一步：创建前端页面

### 可选：创建模型管理页面

参考 `QLExpress实施指南.md` 创建：

1. `frontend/src/views/ModelManagement.vue`
2. 更新路由和菜单
3. 添加API接口定义

或者直接使用API进行测试！

## 🔧 常用API命令

### 创建新模型
```powershell
$newModel = @{
    modelName = "测试评估模型"
    modelCode = "TEST_MODEL"
    description = "用于测试的评估模型"
    version = "1.0"
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8081/api/model-management/models" `
    -Method POST `
    -Body $newModel `
    -ContentType "application/json"
```

### 为模型添加步骤
```powershell
$newStep = @{
    stepName = "数据预处理"
    stepCode = "DATA_PREPROCESSING"
    stepOrder = 1
    stepType = "CALCULATION"
    description = "对原始数据进行预处理"
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8081/api/model-management/models/2/steps" `
    -Method POST `
    -Body $newStep `
    -ContentType "application/json"
```

### 添加算法
```powershell
$newAlgorithm = @{
    algorithmName = "人口密度计算"
    algorithmCode = "POPULATION_DENSITY"
    algorithmOrder = 1
    qlExpression = "(population / area) * 1000"
    outputParam = "population_density"
    description = "计算人口密度"
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8081/api/model-management/steps/1/algorithms" `
    -Method POST `
    -Body $newAlgorithm `
    -ContentType "application/json"
```

## 📊 系统架构图

```
用户界面 (Vue 3)
    ↓
模型管理API (/api/model-management)
    ↓
QLExpress引擎服务 (QLExpressService)
    ↓
数据库 (evaluation_model, model_step, step_algorithm)
    ↓
评估执行引擎
    ↓
结果展示
```

## 🎓 QLExpress表达式速查

| 类型 | 函数 | 示例 |
|------|------|------|
| 算术 | +, -, *, / | `(a + b) / 2` |
| 比较 | ==, !=, <, >, <=, >= | `value >= 100` |
| 逻辑 | &&, \|\|, ! | `a > 0 && b < 10` |
| 条件 | ? : | `score >= 60 ? "通过" : "不通过"` |
| 数学 | SQRT, POW | `SQRT(value)`, `POW(x, 2)` |
| 统计 | AVERAGE, STDEV, SUMSQ | `AVERAGE(values)` |

## ⚡ 故障排查

### 问题1: 后端启动失败
```powershell
# 查看详细日志
Receive-Job -Name "SpringBootApp" -Keep
```

### 问题2: 数据库连接失败
检查MySQL服务是否运行：
```powershell
netstat -an | findstr :3306
```

### 问题3: API返回404
确认后端已启动并监听8081端口：
```powershell
netstat -an | findstr :8081
```

## 📚 完整文档

- **WARP.md** - 项目整体架构
- **QLExpress实施指南.md** - 详细实施步骤
- **完成总结.md** - 已完成工作和下一步计划

## 🎉 恭喜！

系统已成功引入QLExpress动态规则引擎！现在可以：

✅ 通过API动态创建和管理评估模型  
✅ 配置QLExpress表达式而无需修改代码  
✅ 实时验证表达式语法  
✅ 跟踪模型执行历史  

开始探索新功能吧！ 🚀